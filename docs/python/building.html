

<!DOCTYPE html>
<html class="writer-html5" lang="ja" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ビルドとテスト &mdash; Boost.Python（日本語訳）  ドキュメント</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="検索" href="search.html" />
    <link rel="next" title="リファレンスマニュアル" href="reference.html" />
    <link rel="prev" title="チュートリアル" href="tutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Boost.Python（日本語訳）
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">目次</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="release_notes.html">リリースノート</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">チュートリアル</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">ビルドとテスト</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">リファレンスマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">設定に関する情報</a></li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">用語</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">サポートリソース</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">よくある質問と回答</a></li>
<li class="toctree-l1"><a class="reference internal" href="numpy/index.html">Boost.Python（NumPy）</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">動作を確認したプラットフォームとコンパイラ</a></li>
<li class="toctree-l1"><a class="reference internal" href="projects.html">Boost.Python を使用しているプロジェクト</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Boost.Python の裏側</a></li>
<li class="toctree-l1"><a class="reference internal" href="news.html">新着情報・変更履歴</a></li>
<li class="toctree-l1"><a class="reference internal" href="todo.html">TODO リスト</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress_reports.html">LLNL 進捗レポート</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgements.html">謝辞</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Boost.Python（日本語訳）</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>ビルドとテスト</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/building.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="id1">
<h1>ビルドとテスト<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h1>
<blockquote class="pull-quote">
<div><div class="line-block">
<div class="line"><strong>David Abrahams</strong></div>
<div class="line">Copyright © 2002-2015 David Abrahams, Stefan Seefeld</div>
</div>
</div></blockquote>
<div class="section" id="building-requirements">
<span id="id2"></span><h2>必要事項<a class="headerlink" href="#building-requirements" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Boost.Python は Python の<a class="reference external" href="http://www.python.org/2.2">バージョン 2.2</a><a class="footnote-reference brackets" href="#id43" id="id4">1</a>か<a class="reference external" href="http://www.python.jp/">それ以降</a>を要求する。</p>
</div>
<div class="section" id="building-background">
<span id="id6"></span><h2>背景<a class="headerlink" href="#building-background" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>C++ と Python を組み合わせるための基本的なモデルは 2 つある。</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.python.org/doc/current/ext/intro.html">拡張</a>。エンドユーザは Python のインタープリタ（実行可能ファイル）を起動し、C++ で書かれた Python の「拡張モジュール」をインポートする。ライブラリを C++ で書き Python のインターフェイスを与えることで、Python のプログラマが使用できるようにするという考え。Python からはこれらのライブラリは通常の Python モジュールと同じにしか見えない。</p></li>
<li><p><a class="reference external" href="http://www.python.org/doc/current/ext/embedding.html">組み込み</a>。エンドユーザは、Python をライブラリのサブルーチンとして呼び出す C++ で書かれたプログラムを起動する。既存のアプリケーションにスクリプト機能を追加するという考え。</p></li>
</ul>
<p>拡張と組み込みの重要な違いは C++ の <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">main</span></code> 関数の場所である（それぞれ Python のインタープリタと他のプログラムである）。Python を他のプログラムへ組み込む場合であっても、<a class="reference external" href="http://docs.python.jp/2/extending/embedding.html#extending-with-embedding">拡張モジュールは C/C++ から Python のコードへアクセス可能にする最も優れた方法</a>であり、拡張モジュールの使用が両方のモデルの核心であることに注意していただきたい。</p>
<p>わずかな例外を除いて、拡張モジュールは単一のエントリポイントを持ち動的に読み込まれるライブラリとしてビルドする。つまり変更時に他の拡張モジュールや <code class="xref cpp cpp-func docutils literal notranslate"><span class="pre">main</span></code> を持つ実行可能ファイルを再ビルドする必要がない。</p>
</div>
<div class="section" id="building-no-install-quickstart">
<span id="id9"></span><h2>インストールなしのクイックスタート<a class="headerlink" href="#building-no-install-quickstart" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Boost.Python を使い始めるのに「Boost をインストール」する必要はない。この説明では、バイナリを必要に応じてビルドする <a class="reference external" href="http://www.boost.org/build">Boost.Build</a> プロジェクトを利用する。最初のテストは Boost.Python のビルドより少し長くかかるかもしれないが、この方法であれば特定のコンパイラ設定に対してどのライブラリバイナリを使用すべきかといった厄介ごとに悩むことなく、正しいコンパイラオプションをあなた自身が理解できることだろう。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>他のビルドシステムを使用して Boost.Python やその拡張をビルドすることは当然可能であるが、Boost では公式にはサポートしない。<strong>「Boost.Python がビルドできないよ」問題の 99% 以上は、</strong>以下の説明を無視して<strong>他のビルドシステムを使用したことが原因である。</strong></p>
<p>それでも他のビルドシステムを使用したい場合は、以下の説明に従って <strong class="program">bjam</strong> にオプション <code class="xref std std-option docutils literal notranslate"><span class="pre">-a</span> <span class="pre">-o</span></code><code class="samp docutils literal notranslate"><em><span class="pre">filename</span></em></code> を付けて起動し実行するビルドコマンドをファイルにダンプすれば、あなたのビルドシステムで必要なことが分かる。</p>
</div>
<div class="section" id="building-no-install-quickstart-basic-procedure">
<span id="id10"></span><h3>基本的な手順<a class="headerlink" href="#building-no-install-quickstart-basic-procedure" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ol class="arabic">
<li><p>Boost を入手する。Boost <a class="reference external" href="http://www.boost.org/more/getting_started/">導入ガイド</a>の第 1 節、第 2 節を見よ。</p></li>
<li><p><strong class="program">bjam</strong> ビルドドライバを入手する。Boost <a class="reference external" href="http://www.boost.org/more/getting_started/">導入ガイド</a>の第 5 節を見よ。</p></li>
<li><p>Boost をインストールした <code class="file docutils literal notranslate"><span class="pre">example/quickstart/</span></code> ディレクトリに <strong class="command">cd</strong> で移動する。小さなプロジェクト例がある。</p></li>
<li><p><strong class="program">bjam</strong> を起動する。すべてのテストターゲットをビルドするため、<a class="reference external" href="http://www.boost.org/more/getting_started/">導入ガイド</a>第 5 節の起動例にある「<code class="xref std std-option docutils literal notranslate"><span class="pre">stage</span></code>」引数を「<code class="xref std std-option docutils literal notranslate"><span class="pre">test</span></code>」に置き換える。またテストが生成した出力を見るため、引数に「<code class="xref std std-option docutils literal notranslate"><span class="pre">--verbose-test</span></code>」を追加する。</p>
<p>Windows の場合、<strong class="program">bjam</strong> の起動は以下のようになる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">C:\\…\quickstart&gt; bjam toolset=msvc --verbose-test test</span>
</pre></div>
</div>
<p>Unix 系の場合はおそらく、</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">…/quickstart$ bjam toolset=gcc --verbose-test test</span>
</pre></div>
</div>
</li>
</ol>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>簡単のために、このガイドの残りの部分ではパス名に Windows ユーザになじみのあるバックスラッシュではなく、Unix スタイルのスラッシュを使用する。スラッシュは<a class="reference external" href="http://www.boost.org/more/getting_started/windows.html#command-prompt">コマンドプロンプト</a>ウィンドウ以外のあらゆる場所で機能するはずである（コマンドプロンプトだけはバックスラッシュを使用しなければならない）。</p>
</div>
<p>ここまでの手順がうまくいったら、<code class="xref py py-mod docutils literal notranslate"><span class="pre">extending</span></code> という名前の拡張モジュールのビルドが終わり、<code class="file docutils literal notranslate"><span class="pre">test_extending.py</span></code> という Python スクリプトが走ってテストも完了しているはずである。また、Python を組み込む <strong class="program">embedding</strong> という簡単なアプリケーションもビルド、起動する。</p>
</div>
<div class="section" id="building-no-install-quickstart-in-case-of-trouble">
<span id="id15"></span><h3>問題が起きた場合<a class="headerlink" href="#building-no-install-quickstart-in-case-of-trouble" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>コンパイラやリンカのエラーメッセージが大量に表示された場合、Boost.Build が Python のインストール情報を見つけられていない可能性が高い。<strong class="program">bjam</strong> を起動する最初の数回、<code class="xref std std-option docutils literal notranslate"><span class="pre">--debug-configuration</span></code> オプションを <strong class="program">bjam</strong> に渡して Boost.Build が Python のインストール情報をすべて正しく見つけられているか確認することだ。失敗している場合は、以下の <a class="reference internal" href="#building-configuring-boost-build"><span class="std std-ref">Boost.Build を設定する</span></a>の節を試すとよい。</p>
<p>それでもなお問題が解決しない場合は、以下のメーリングリストに手助けしてくれる人がいるかもしれない。</p>
<ul class="simple">
<li><p>Boost.Build に関する話題は <a class="reference external" href="http://www.boost.org/more/mailing_lists.htm#jamboost">Boost.Build のメーリングリスト</a></p></li>
<li><p>Boost.Python に固有の話題は Python の <a class="reference external" href="http://www.boost.org/more/mailing_lists.htm#cplussig">C++ Sig</a></p></li>
</ul>
</div>
<div class="section" id="building-no-install-quickstart-in-case-everything-seemed-to-wor">
<span id="id17"></span><h3>すべて問題無い場合<a class="headerlink" href="#building-no-install-quickstart-in-case-everything-seemed-to-wor" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>おめでとう！ Boost.Python に慣れていなければ、この時点でしばらくビルドに関することを忘れ、<a class="reference internal" href="tutorial.html"><span class="doc">チュートリアル</span></a>や<a class="reference internal" href="reference.html"><span class="doc">リファレンス</span></a>を通じてライブラリの学習に集中するとよいかもしれない。quickstart プロジェクトに変更を加えて、API について学んだことを十分に試してみるのもよい。</p>
</div>
<div class="section" id="building-no-install-quickstart-modifying-the-example-project">
<span id="id18"></span><h3>サンプルプロジェクトを変更する<a class="headerlink" href="#building-no-install-quickstart-modifying-the-example-project" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>拡張モジュールを（Boost ディストリビューション内の 1 つのソースファイルである）<code class="file docutils literal notranslate"><span class="pre">extending.cpp</span></code> 内に限定し、これを <code class="xref py py-mod docutils literal notranslate"><span class="pre">extending</span></code> としてインポートすることに満足しているのであれば、ここでやめてしまってもよい。しかしながら少しぐらいは変更したいと思うことだろう。<a class="reference external" href="http://www.boost.org/build">Boost.Build</a> について詳しく学ぶことなく先に進む方法はある。</p>
<p>今ビルドしたプロジェクトは現在のディレクトリにある 2 つのファイルで規定されている。<code class="file docutils literal notranslate"><span class="pre">boost-build.jam</span></code> は Boost ビルドシステムのコードの場所を <strong class="program">bjam</strong> に指定する。<code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> はビルドしたターゲットを記述する。これらのファイルにはコメントを大量に書いてあるので、変更は容易なはずである。ただし空白の保持には注意していただきたい。<code class="code docutils literal notranslate"><span class="pre">;</span></code> のような区切り文字は前後に空白がなければ <strong class="program">bjam</strong> は認識しない。</p>
<div class="section" id="building-no-install-quickstart-modifying-the-example-project-relocate-the-project">
<span id="id20"></span><h4>プロジェクトの場所を変更する<a class="headerlink" href="#building-no-install-quickstart-modifying-the-example-project-relocate-the-project" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>Boost ディストリビューションに変更が生じないよう、このプロジェクトをどこか他の場所にコピーしたいと思うことだろう。単純に次のようにする。</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">example/quickstart/</span></code> ディレクトリ全体を新しいディレクトリにコピーする。</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">boost-build.jam</span></code> および <code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> の新コピーにおいて、ファイルの先頭付近で相対パスを探し（コメントで分かりやすくマークしてある）、ファイルが <code class="file docutils literal notranslate"><span class="pre">example/quickstart</span></code> ディレクトリ内の元の場所にあったときと同様に Boost ディストリビューションを指すように編集する。</p></li>
</ol>
<p><a class="reference external" href="http://www.boost.org/doc/libs/python/example/quickstart/boost-build.jam">http://www.boost.org/doc/libs/python/example/quickstart/boost-build.jam</a>
<a class="reference external" href="http://www.boost.org/doc/libs/python/example/quickstart/Jamroot">http://www.boost.org/doc/libs/python/example/quickstart/Jamroot</a></p>
<p>例えばプロジェクトを <code class="file docutils literal notranslate"><span class="pre">/home/dave/boost_1_34_0/libs/python/example/quickstart</span></code> から <code class="file docutils literal notranslate"><span class="pre">/home/dave/my-project</span></code> へ移動したとすると、<code class="file docutils literal notranslate"><span class="pre">boost-build.jam</span></code> の最初のパスは</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>../../../../tools/build/src
</pre></div>
</div>
<p>次のように変更する。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/dave/boost_1_34_0/tools/build/src
</pre></div>
</div>
<p>また <code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> の最初のパスは</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>../../../..
</pre></div>
</div>
<p>次のように変更する。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/home/dave/boost_1_34_0
</pre></div>
</div>
</div>
<div class="section" id="building-no-install-quickstart-modifying-the-example-project-add-new-or-change-names-of-exist">
<span id="id21"></span><h4>新しいソースファイルを追加するか既存ファイルの名前を変更する<a class="headerlink" href="#building-no-install-quickstart-modifying-the-example-project-add-new-or-change-names-of-exist" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>拡張モジュールや組み込みアプリケーションのビルドに必要なファイルの名前は、<code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> 内にそれぞれ <code class="file docutils literal notranslate"><span class="pre">extending.cpp</span></code> 、<code class="file docutils literal notranslate"><span class="pre">embedding.cpp</span></code> の右に並べて書く。各ファイル名の前後に空白を入れるのを忘れてはならない。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>… file1.cpp file2.cpp file3.cpp …
</pre></div>
</div>
<p>当然ながら、ソースファイルの名前を変更したければ <code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> 内の名前を編集して Boost.Build に通知する。</p>
</div>
<div class="section" id="building-no-install-quickstart-modifying-the-example-project-change-the-name-of-your-extensio">
<span id="id22"></span><h4>拡張モジュールの名前を変更する<a class="headerlink" href="#building-no-install-quickstart-modifying-the-example-project-change-the-name-of-your-extensio" title="このヘッドラインへのパーマリンク">¶</a></h4>
<p>拡張モジュールの名前は以下の 2 つで決まる。</p>
<ol class="arabic simple">
<li><p><code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> 内の <code class="code docutils literal notranslate"><span class="pre">python-extension</span></code> 直後の名前</p>
</li>
<li><p><code class="file docutils literal notranslate"><span class="pre">extending.cpp</span></code> 内で <code class="xref c c-macro docutils literal notranslate"><span class="pre">BOOST_PYTHON_MODULE</span></code> に渡した名前</p>
</li>
</ol>
<p>拡張モジュールの名前を <code class="xref py py-mod docutils literal notranslate"><span class="pre">extending</span></code> から <code class="xref py py-mod docutils literal notranslate"><span class="pre">hello</span></code> に変更するには、<code class="file docutils literal notranslate"><span class="pre">Jamroot</span></code> を編集して次の行を</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python-extension extending : extending.cpp ;
</pre></div>
</div>
<p>以下のように変更する。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>python-extension hello : extending.cpp ;
</pre></div>
</div>
<p>また <code class="file docutils literal notranslate"><span class="pre">extending.cpp</span></code> を編集して次の行を</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>BOOST_PYTHON_MODULE(extending)
</pre></div>
</div>
<p>以下のように変更する。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>BOOST_PYTHON_MODULE(hello)
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="boost-python">
<span id="building-installing-boost-python-on-your-system"></span><h2>システムに Boost.Python をインストールする<a class="headerlink" href="#boost-python" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Boost.Python は（ヘッダオンリーライブラリとは逆に）個別にコンパイルが必要なライブラリであるため、ユーザは Boost.Python ライブラリバイナリのサービスに依存する。</p>
<p>Boost.Python ライブラリのバイナリを普通にインストールする必要がある場合、Boost の<a class="reference external" href="http://www.boost.org/more/getting_started/index.html">導入ガイド</a>を見ればその作成手順が一通り分かるだろう。ソースからバイナリをビルドする場合、Boost の全バイナリではなく Boost.Python のバイナリだけがビルドされるよう、<strong class="program">bjam</strong> に <code class="xref std std-option docutils literal notranslate"><span class="pre">--with-python</span></code> 引数を（あるいは <code class="file docutils literal notranslate"><span class="pre">configure</span></code> に <code class="xref std std-option docutils literal notranslate"><span class="pre">--with-libraries=python</span></code> 引数を）渡すとよい。</p>
</div>
<div class="section" id="building-configuring-boost-build">
<span id="id24"></span><h2>Boost.Build を設定する<a class="headerlink" href="#building-configuring-boost-build" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference external" href="http://www.boost.org/build/doc/html/bbv2/overview/configuration.html">Boost.Build のリファレンスマニュアル</a>にあるとおり、ビルドシステムで利用可能なツールとライブラリの指定はホームディレクトリの <code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> で行う。<code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> を作成・編集して Python の起動、ヘッダのインクルード、ライブラリのリンクについての方法を Boost.Build に指定する必要があるかもしれない。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p class="rubric">Unix 系 OS のユーザ</p>
<p>Unix 系 OS を使用しており Boost の <code class="file docutils literal notranslate"><span class="pre">configure</span></code> スクリプトを走らせた場合、<code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> が生成されている可能性がある。<a class="footnote-reference brackets" href="#id44" id="id26">2</a> <strong class="program">configure</strong>/<strong class="program">make</strong> シーケンスが成功して Boost.Python のバイナリがビルドされていれば、<code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> はおそらく既に正しい状態になっている。</p>
</div>
<p>Python を「標準的な」形でインストールしたのであれば、特に行うことはない。<code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> で python を設定していない（かつ Boost.Build コマンドラインで <code class="xref std std-option docutils literal notranslate"><span class="pre">--without-python</span></code> を指定していない）のであれば、Boost.Build は自動的に以下と等価なことを行い、最も適切な場所から Python を自動的に探し出す。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import toolset : using ;
using python ;
</pre></div>
</div>
<p>ただしこれが行われるのは Boost.Python のプロジェクトファイルを使用した場合だけである（例えば <code class="xref py py-mod docutils literal notranslate"><span class="pre">quickstart</span></code> の方法のように別のプロジェクトから参照される場合）。個別にコンパイルした Boost.Python バイナリにリンクする場合は、上に挙げた最小限のおまじないで <code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> をセットアップしなければならない。</p>
<div class="section" id="python">
<span id="building-configuring-boost-build-python-configuration-parameters"></span><h3>Python の設定引数<a class="headerlink" href="#python" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python を複数バージョンインストールしている場合や Python を通常でない方法でインストールした場合は、以下の省略可能な引数のいずれか、またはすべてを <code class="code docutils literal notranslate"><span class="pre">using</span> <span class="pre">python</span></code> に与えなければならない可能性がある。</p>
<dl class="std option">
<dt id="cmdoption-arg-version">
<code class="sig-name descname">version</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-version" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>使用する Python のバージョン。（メジャー）.（マイナー）の形式でなければらない（例：<code class="code docutils literal notranslate"><span class="pre">2.3</span></code>）。サブマイナーバージョンは含めてはならない（<code class="code docutils literal notranslate"><span class="pre">2.5.1</span></code> は<strong>不可</strong>）。複数のバージョンの Python をインストールした場合、大抵は version が省略不可能な唯一の引数となる。</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-arg-cmd-or-prefix">
<code class="sig-name descname">cmd-or-prefix</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-cmd-or-prefix" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Python インタープリタを起動するコマンド。または Python のライブラリやヘッダファイルのインストール接頭辞。このパラメータの使用は、適切な Python 実行可能ファイルがない場合に限定すること。</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-arg-includes">
<code class="sig-name descname">includes</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-includes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Python ヘッダの <code class="code docutils literal notranslate"><span class="pre">#include</span></code> パス。通常、<a class="reference internal" href="#cmdoption-arg-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">version</span></code></a> と <a class="reference internal" href="#cmdoption-arg-cmd-or-prefix"><code class="xref std std-option docutils literal notranslate"><span class="pre">cmd-or-prefix</span></code></a> から適切なパスが推測される。</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-arg-libraries">
<code class="sig-name descname">libraries</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-libraries" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>Python ライブラリのバイナリへのパス。MacOS/Darwin では Python フレームワークのパスを渡してもよい。通常、<a class="reference internal" href="#cmdoption-arg-version"><code class="xref std std-option docutils literal notranslate"><span class="pre">version</span></code></a> と <a class="reference internal" href="#cmdoption-arg-cmd-or-prefix"><code class="xref std std-option docutils literal notranslate"><span class="pre">cmd-or-prefix</span></code></a> から適切なパスが推測される。</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-arg-condition">
<code class="sig-name descname">condition</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-condition" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定する場合は、Boost.Build が使用する Python の設定を選択するときのビルド設定にマッチした Boost.Build パラメータの集合でなければならない。詳細は以下の例を見よ。</p>
</dd></dl>

<dl class="std option">
<dt id="cmdoption-arg-extension-suffix">
<code class="sig-name descname">extension-suffix</code><code class="sig-prename descclassname"></code><a class="headerlink" href="#cmdoption-arg-extension-suffix" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>拡張モジュール名の真のファイル拡張子の前に追加する文字列。ほとんどの場合、この引数を使用する必要はない。大抵の場合、この接尾辞を使用するのは Windows において Python のデバッグビルドをターゲットにする場合だけであり、<a class="reference internal" href="#building-python-debugging-builds"><span class="std std-ref">&lt;python-debugging&gt;</span></a> 機能の値に基づいて自動的に設定される。しかしながら少なくとも 1 つの Linux のディストリビューション（Ubuntu Feisty Fawn）では <a class="reference external" href="https://wiki.ubuntu.com/PyDbgBuilds">python-dbg</a> は特殊な設定がなされており、この種の接頭辞を使用しなければならない。</p>
</dd></dl>

</div>
<div class="section" id="building-configuring-boost-build-examples">
<span id="id27"></span><h3>例<a class="headerlink" href="#building-configuring-boost-build-examples" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下の例では大文字小文字の区別や、<strong>特に空白</strong>が重要である。</p>
<ul>
<li><p>Python 2.5 と Python 2.4 の両方をインストールしている場合、<code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> を次のようにしておく。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>using python : 2.5 ;  # 両方のバージョンの Python を有効にする

using python : 2.4 ;  # python 2.4 でビルドする場合は、python=2.4 を
                      # コマンドラインに追加する。
</pre></div>
</div>
<p>最初のバージョン設定（2.5）が既定となる。Python 2.4 についてビルドする場合は <strong class="program">bjam</strong> コマンドラインに <code class="xref std std-option docutils literal notranslate"><span class="pre">python=2.4</span></code> を追加する。</p>
</li>
<li><p>Python を通常でない場所にインストールしている場合、<a class="reference internal" href="#cmdoption-arg-cmd-or-prefix"><code class="xref std std-option docutils literal notranslate"><span class="pre">cmd-or-prefix</span></code></a> 引数にインタープリタへのパスを与えるとよい。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>using python : : /usr/local/python-2.6-beta/bin/python ;
</pre></div>
</div>
</li>
<li><p>特定のツールセットに対して個別の Python ビルドを置いている場合、<a class="reference internal" href="#cmdoption-arg-condition"><code class="xref std std-option docutils literal notranslate"><span class="pre">condition</span></code></a> 引数にそのツールセットを与えるとよい。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>using python ;  # 通常のツールセットで使用

# Intel C++ ツールセットで使用
    using python
     : # version
     : c:\\Devel\\Python-2.5-IntelBuild\\PCBuild\\python # cmd-or-prefix
     : # includes
     : # libraries
     : &lt;toolset&gt;intel # condition
     ;
</pre></div>
</div>
</li>
<li><p>Python のソースをダウンロードし、Windows 上でソースから通常版と「<a class="reference internal" href="#building-python-debugging-builds"><span class="std std-ref">Python デバッグ</span></a>」ビルド版の両方をビルドした場合、次のようにするとよい。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>using python : 2.5 : C:\\src\\Python-2.5\\PCBuild\\python ;
using python : 2.5 : C:\\src\\Python-2.5\\PCBuild\\python_d
  : # includes
  : # libs
  : &lt;python-debugging&gt;on ;
</pre></div>
</div>
</li>
<li><p>Windows でビルドした bjam では、Windows と <a class="reference external" href="http://cygwin.com/">Cygwin</a> の両方の Python 拡張をビルド・テストできるよう <code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> をセットアップできる。Cygwin の Python インストールに対して <a class="reference internal" href="#cmdoption-arg-condition"><code class="xref std std-option docutils literal notranslate"><span class="pre">condition</span></code></a> 引数に <code class="code docutils literal notranslate"><span class="pre">&lt;target-os&gt;cygwin</span></code> を渡すだけでよい。</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span># Windows の場合
using python ;

# Cygwin の場合
using python : : c:\\cygwin\\bin\\python2.5 : : : &lt;target-os&gt;cygwin ;
</pre></div>
</div>
<p>ビルドリクエストに <code class="xref std std-option docutils literal notranslate"><span class="pre">target-os=cygwin</span></code> と書くと、Cygwin 版の Python でビルドが行われる。<a class="footnote-reference brackets" href="#id45" id="id28">3</a></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bjam target-os=cygwin toolset=gcc</span>
</pre></div>
</div>
<p>他の方法でも同様に動作すると思う（Windows 版の Python をターゲットにして <a class="reference external" href="http://cygwin.com/">Cygwin</a> 版の bjam を使用する場合）が、本稿執筆時点ではそのような組み合わせのビルドに対する Boost.Build ツールセットのサポートにはバグがあるようだ。</p>
</li>
<li><p><a class="reference external" href="http://zigzag.cs.msu.su/boost.build/wiki/AlternativeSelection">Boost.Build がターゲットを選択する方法</a>が原因で、ビルドリクエストは完全に明確にしなければならないということに注意していただきたい。例えば、次のようであるとすると、</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>using python : 2.5 ; # 通常の Windows ビルドの場合
using python : 2.4 : : : : &lt;target-os&gt;cygwin ;
</pre></div>
</div>
<p>以下の方法でビルドするとエラーになる。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bjam target-os=cygwin</span>
</pre></div>
</div>
<p>代わりに、こう書く必要がある。</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">bjam target-os=cygwin/python=2.4</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="building-choosing-a-boost-python-library">
<span id="id31"></span><h2>Boost.Python ライブラリのバイナリを選択する<a class="headerlink" href="#building-choosing-a-boost-python-library" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>（Boost.Build に自動的に正しいライブラリを構築、リンクさせる代わりに）ビルド済みの Boost.Python ライブラリを使用する場合、どれをリンクするか考える必要がある。Boost.Python バイナリには動的版と静的版がある。アプリケーションに応じて注意して選択しなければならない。<a class="footnote-reference brackets" href="#id46" id="id32">4</a></p>
<div class="section" id="building-choosing-a-boost-python-library-the-dynamic-binary">
<span id="id33"></span><h3>動的バイナリ<a class="headerlink" href="#building-choosing-a-boost-python-library-the-dynamic-binary" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>動的ライブラリは最も安全で最も汎用性の高い選択である。</p>
<ul class="simple">
<li><p>与えられたツールセットでビルドしたすべての拡張モジュールが、ライブラリコードの単一のコピーを使用する。<a class="footnote-reference brackets" href="#id47" id="id34">5</a></p></li>
<li><p>ライブラリには型変換レジストリが含まれる。すべての拡張モジュールが単一のレジストリを共有するので、ある動的に読み込んだ拡張モジュールで Python へエクスポートしたクラスのインスタンスを、別のモジュールでエクスポートした関数へ渡すことができる。</p></li>
</ul>
</div>
<div class="section" id="building-choosing-a-boost-python-library-the-static-binary">
<span id="id35"></span><h3>静的バイナリ<a class="headerlink" href="#building-choosing-a-boost-python-library-the-static-binary" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>以下のいずれかの場合は Boost.Python の静的ライブラリを使用するのが適切である。</p>
<ul class="simple">
<li><p>Python を<a class="reference external" href="http://docs.python.jp/2/extending/extending.html">拡張</a>していて、動的に読み込んだ拡張モジュールで他の Boost.Python 拡張モジュールから使用する必要のない型をエクスポートしており、かつそれらの間でコアライブラリコードが複製されても問題ない場合。</p></li>
<li><p>Python をアプリケーションに<a class="reference external" href="http://docs.python.jp/2/extending/embedding.html">組み込んで</a>おり、かつ以下のいずれかの場合。</p>
<ul>
<li><p>MacOS か AIX 以外の Unix 系 OS をターゲットにしていて、動的に読み込んだ拡張モジュールから実行可能ファイルの一部である Boost.Python ライブラリシンボルが「見える」場合。</p></li>
<li><p>またはアプリケーションに何らかの Boost.Python 拡張モジュールを静的にリンクしており、かつ動的に読み込んだ Boost.Python 拡張モジュールが静的にリンクした拡張モジュールでエクスポートした型を使用可能でも問題ない場合（あるいはその逆）。</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="include">
<span id="building-include-issues"></span><h2><code class="code docutils literal notranslate"><span class="pre">#include</span></code> に関すること<a class="headerlink" href="#include" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ol class="arabic simple">
<li><p>Boost.Python を使用するプログラムの翻訳単位で直接 <code class="code docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;python.h&quot;</span></code> と書きたくなったら、代わりに <code class="code docutils literal notranslate"><span class="pre">#include</span> <span class="pre">&quot;boost/python/detail/wrap_python.hpp&quot;</span></code> を使用せよ。こうすることで Boost.Python を使用するのに必要ないくつかの事柄が適当に処理される（その中の 1 つを次節で見る）。</p></li>
<li><p><code class="file docutils literal notranslate"><span class="pre">wrap_python.hpp</span></code> の前にシステムヘッダをインクルードしないよう注意せよ。この制限は実際には Python によるものであり、より正確には Python とオペレーティングシステムの相互作用によるものである。詳細は <a class="reference external" href="http://docs.python.org/ext/simpleExample.html">http://docs.python.org/ext/simpleExample.html</a> <a class="footnote-reference brackets" href="#id48" id="id38">6</a> を見よ。</p></li>
</ol>
</div>
<div class="section" id="building-python-debugging-builds">
<span id="id39"></span><h2>Python のデバッグビルド<a class="headerlink" href="#building-python-debugging-builds" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python は特殊な「python debugging」設定でビルドすることで、拡張モジュールの開発者にとって非常に有用なチェックとインストゥルメント（instrumentation）を追加できる。デバッグ設定が使用するデータ構造は追加のメンバを含んでいるため、<strong>python debugging を有効にした Python 実行可能ビルドを、有効にせずにコンパイルしたライブラリや拡張モジュールとともに使用することはできない（その逆も同様である）。</strong></p>
<p>Python のビルド済み実行可能の「python debugging」版はほとんどの Python ディストリビューションでは提供されておらず<a class="footnote-reference brackets" href="#id49" id="id40">7</a>、それらのビルドをユーザに強制したくないので、<code class="xref std std-option docutils literal notranslate"><span class="pre">debug</span></code> ビルド（既定）において python debugging を自動的に有効化することはない。代わりに <code class="xref std std-option docutils literal notranslate"><span class="pre">python-debugging</span></code> という特殊なビルドプロパティを用意しており、これを使用すると適切なプリプロセッサシンボルが定義され正しいライブラリがリンク先として選択される。</p>
<p>Unix 系プラットフォームでは、デバッグ版 Python のデータ構造は <code class="xref c c-macro docutils literal notranslate"><span class="pre">Py_DEBUG</span></code> シンボルを定義したときのみ使用される。多くの Windows コンパイラでは、プリプロセッサシンボル <code class="xref c c-macro docutils literal notranslate"><span class="pre">_DEBUG</span></code> を付けてビルドすると、Python は既定では Python DLL の特殊デバッグ版へのリンクを強制する。このシンボルは Python の有無とは別にごくありふれたものであるので、Boost.Python は <code class="file docutils literal notranslate"><span class="pre">boost/python/detail/wrap_python.hpp</span></code> で <code class="file docutils literal notranslate"><span class="pre">Python.h</span></code> をインクルードするときから <code class="xref c c-macro docutils literal notranslate"><span class="pre">BOOST_DEBUG_PYTHON</span></code> が定義されるまでの間、一時的に <code class="xref c c-macro docutils literal notranslate"><span class="pre">_DEBUG</span></code> を未定義にする。結論としては「python debugging」が必要で Boost.Build を使用しない場合は、<code class="xref c c-macro docutils literal notranslate"><span class="pre">BOOST_DEBUG_PYTHON</span></code> が定義されているのを確認することである。そうでなければ python debugging は無効になる。</p>
</div>
<div class="section" id="building-testing-boost-python">
<span id="id41"></span><h2>Boost.Python をテストする<a class="headerlink" href="#building-testing-boost-python" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Boost.Build の完全なテストスイートを走らせるには、Boost ディストリビューションの <code class="file docutils literal notranslate"><span class="pre">test</span></code> サブディレクトリで <strong class="program">bjam</strong> を起動する。</p>
</div>
<div class="section" id="mingw-cygwin-mno-cygwin-gcc">
<span id="building-notes-for-mingw-and-cygwin-with"></span><h2>MinGW（および Cygwin の -mno-cygwin）の GCC ユーザに対する注意<a class="headerlink" href="#mingw-cygwin-mno-cygwin-gcc" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python の 2.4.1 より前のバージョンを MinGW の 3.0.0（binutils-2.13.90-20030111-1）より前のバージョンで使用する場合は、MinGW 互換バージョンの Python ライブラリを作成する必要がある（Python に付属のものは Microsoft 互換のリンカでしか動作しない）。『<a class="reference external" href="http://docs.python.jp/2/install/">Python モジュールのインストール</a>』の「拡張モジュールのビルド: 小技と豆知識」―「Windows で非 Microsoft コンパイラを使ってビルドするには」の節に従い、<code class="file docutils literal notranslate"><span class="pre">libpython</span><em><span class="pre">XX</span></em><span class="pre">.a</span></code> を作成する。<code class="samp docutils literal notranslate"><em><span class="pre">XX</span></em></code> はインストールした Python のメジャーバージョンとマイナーバージョン番号である。</p>
<dl class="footnote brackets">
<dt class="label" id="id43"><span class="brackets"><a class="fn-backref" href="#id4">1</a></span></dt>
<dd><p>Boost.Python の以前のバージョンと Python 2.2 の組み合わせでテストを行っており互換性を損なうようなことはしていないと<strong>考えて</strong>いる。しかしながら Boost.Python の最新版では Python の 2.4 より前のバージョンに対してテストを行っていない可能性があり、Python 2.2 および 2.3 をサポートしているとは 100% 言い切れない。</p>
</dd>
<dt class="label" id="id44"><span class="brackets"><a class="fn-backref" href="#id26">2</a></span></dt>
<dd><p><strong class="program">configure</strong> はホームディレクトリにある既存の <code class="file docutils literal notranslate"><span class="pre">user-config.jam</span></code> について、（あれば）バックアップを作成した後で上書きする。</p>
</dd>
<dt class="label" id="id45"><span class="brackets"><a class="fn-backref" href="#id28">3</a></span></dt>
<dd><p><code class="code docutils literal notranslate"><span class="pre">&lt;target-os&gt;cygwin</span></code> 機能は <strong class="program">gcc</strong> ツール群の <code class="code docutils literal notranslate"><span class="pre">&lt;flavor&gt;cygwin</span></code> サブ機能とは別物であることに注意していただきたい。MinGW GCC もインストールしている場合は、両者を明示的に扱わなければならない。</p>
</dd>
<dt class="label" id="id46"><span class="brackets"><a class="fn-backref" href="#id32">4</a></span></dt>
<dd><p>Boost.Python の静的ビルドと動的ビルドを区別する方法：</p>
<ul class="simple">
<li><p><a class="reference external" href="http://www.boost.org/more/getting_started/windows.html#library-naming">Windows の場合</a></p></li>
<li><p><a class="reference external" href="http://www.boost.org/more/getting_started/unix-variants.html#library-naming">Unix 系の場合</a></p></li>
</ul>
</dd>
<dt class="label" id="id47"><span class="brackets"><a class="fn-backref" href="#id34">5</a></span></dt>
<dd><p>ほとんどの Unix/Linux 系プラットフォームでは動的に読み込んだオブジェクトを共有するため、異なるコンパイラツールセットでビルドした拡張モジュールを同一の Python インスタンスに読み込んだとき常に異なる Boost.Python ライブラリのコピーを使用するか定かではない。それらのコンパイラが互換性のある ABI を有しているのであれば、2 つのライブラリでビルドした拡張モジュールは相互運用可能なので、別のライブラリを使用しないほうが望ましい。そうでなければ拡張モジュールと Boost.Python はクラスレイアウト等が異なるため、大惨事となるかもしれない。何が起こるか確認する実験を行ってくれる人がいれば幸いである。</p>
</dd>
<dt class="label" id="id48"><span class="brackets"><a class="fn-backref" href="#id38">6</a></span></dt>
<dd><p>訳注　日本語訳は <a class="reference external" href="http://docs.python.jp/2/extending/extending.html#extending-simpleexample">http://docs.python.jp/2/extending/extending.html#extending-simpleexample</a> （Python 2.x の場合）。</p>
</dd>
<dt class="label" id="id49"><span class="brackets"><a class="fn-backref" href="#id40">7</a></span></dt>
<dd><p>Unix 系列のプラットフォームでは、debugging python と関連ライブラリは Python のビルド設定で <code class="xref std std-option docutils literal notranslate"><span class="pre">--with-pydebug</span></code> を追加するとビルドされる。Windows では Python のデバッグ版は、Python の完全なソースコードディストリビューションの <code class="file docutils literal notranslate"><span class="pre">PCBuild</span></code> サブディレクトリにある Visual Studio プロジェクトの「Win32 Debug」ターゲットから生成される。</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="reference.html" class="btn btn-neutral float-right" title="リファレンスマニュアル" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial.html" class="btn btn-neutral float-left" title="チュートリアル" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2020, exeal

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>